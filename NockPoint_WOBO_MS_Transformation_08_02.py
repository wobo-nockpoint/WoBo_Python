#
# Copyright 2021 Nockpoint, Inc.
#
# VERSION DATE: May 21, 2021
#
# BY INDICATING YOUR ACCEPTANCE OF THIS AGREEMENT OR DOWNLOADING, INSTALLING OR OTHERWISE ACCESSING OR USING ANY SOFTWARE OR SERVICE, YOU ARE ACCEPTING ALL OF THE TERMS AND CONDITIONS OF THIS AGREEMENT. IF YOU DO NOT AGREE TO THESE TERMS AND CONDITIONS, YOU MAY NOT USE ANY SOFTWARE OR SERVICE. YOU AGREE THAT THIS AGREEMENT IS ENFORCEABLE LIKE ANY WRITTEN AGREEMENT SIGNED BY YOU.
#
# IF YOU ARE USING ANY SERVICE AS AN EMPLOYEE, CONTRACTOR, OR AGENT OF A CORPORATION, PARTNERSHIP OR SIMILAR ENTITY, THEN YOU MUST BE AUTHORIZED TO SIGN FOR AND BIND SUCH ENTITY IN ORDER TO ACCEPT THE TERMS OF THIS AGREEMENT, AND YOU REPRESENT AND WARRANT THAT YOU HAVE THE AUTHORITY TO DO SO. THE RIGHTS GRANTED UNDER THIS AGREEMENT ARE EXPRESSLY CONDITIONED UPON ACCEPTANCE BY SUCH AUTHORIZED PERSONNEL.
#
#
# AGREEMENT
#
# This Nockpoint Terms of Service ("Agreement") is entered into by and between Nockpoint and the entity or person placing an order for or accessing any Service ("Customer" or "you"). This Agreement consists of the terms and conditions set forth below and any attachments, addenda or exhibits referenced in the Agreement, and any Order Forms and SOWs that reference this Agreement. Capitalized terms used herein that are not otherwise defined shall have the meanings set forth in Section 13 below.
#
# The Effective Date of this Agreement is the date which is the earlier of (a) Customer's initial access to any Service through any online provisioning, registration or order process or (b) the effective date of the first Order Form or Reseller Order Form, as applicable, referencing this Agreement. This Agreement will govern Customer' initial purchase on the Effective Date as well as any future purchases made by Customer that reference this Agreement.
#
# Purchase from Reseller: Customer may procure use of any Service from an authorized reseller of Nockpoint ("Reseller") pursuant to a separate Reseller Order Form that references this Agreement. Customer's use of any Service procured through a Reseller will be subject to the terms of this Agreement and all fees payable for such use shall be payable pursuant to the terms set forth in the Reseller Order Form.
#
# Modifications to this Agreement: From time to time, Nockpoint may modify this Agreement. Unless otherwise specified by Nockpoint, changes become effective for Customer upon renewal of the then-current Subscription Term or entry into a new Order Form after the updated version of this Agreement goes into effect. Nockpoint will use reasonable efforts to notify Customer of the changes through communications via Customer's Account, email or other means. Customer may be required to click to accept or otherwise agree to the modified Agreement before renewing a Subscription Term or entering into a new Order Form, and in any event continued use of any Service after the updated version of this Agreement goes into effect will constitute Customer's acceptance of such updated version.
#
# 1.   USE OF SERVICE
#
# 1.1.  Service Provision and Access; Client Software. Nockpoint will make the Service available to Customer for the Subscription Term solely for use by Customer and its Users in accordance with the terms and conditions of this Agreement, the Documentation, and the Order Form. Customer may permit its Contractors and Affiliates to serve as Users provided that any use of the Service by each such Contractor or Affiliate is solely for the benefit of Customer or such Affiliate. Customer shall be responsible for each User's compliance with this Agreement. To the extent use of a Service requires Customer to install Client Software, Nockpoint grants to Customer a limited, non-transferable, non-sublicensable, non-exclusive license during the Subscription Term to use the object code form of the Client Software internally in connection with Customer's and its Affiliates' use of the Service, subject to the terms and conditions of this Agreement and the Documentation.
#
# 1.2.  Affiliates. Customer Affiliates may purchase Services from Nockpoint or a Nockpoint Affiliate by executing an Order Form or SOW which is governed by the terms of this Agreement. This will establish a new and separate agreement between the Customer Affiliate and the Nockpoint entity signing such Order Form. If the Customer Affiliate resides in a different country than Customer, the Order Form may include modifications to terms applicable to the transaction(s) (including but not limited to tax terms and governing law).
#
# 1.3.  Compliance with Applicable Laws. Nockpoint will provide the Services in accordance with its obligations under laws and government regulations applicable to Nockpoint's provision of the Services to its customers generally, including, without limitation, those related to data privacy and data transfer, international communications, and the exportation of technical or personal data, without regard to Customer's particular use of the Services and subject to Customer's use of the Services in accordance with this Agreement.
#
# 1.4.  Sample Data; Third Party Applications. Nockpoint may make Sample Data available for Customer. Customer acknowledges that Sample Data is example data only, which may not be complete, current, or accurate. Customer will not (and will not permit any third party to) copy or export any Sample Data and agrees that Nockpoint may delete or require Customer to cease using Sample Data at any time upon advance notice. Nockpoint may also provide URL links or interconnectivity within the Services to facilitate Customer's use of Third Party Applications, at Customer's sole discretion. Notwithstanding the foregoing, any procurement or use of Third Party Applications is solely between Customer and the applicable third party and Nockpoint will have no liability for such Third Party Applications.
#
# 1.5.  General Restrictions. Customer will not (and will not permit any third party to): (a) sell, rent, lease, license, distribute, provide access to, sublicense, or otherwise make available any Service (or Deliverables, if applicable) to a third party (except as set forth in the Documentation for Service features expressly intended to enable Customer to provide its third parties with access to Customer Data, or the SOW, as applicable) or in a service bureau or outsourcing offering; (b) use any Service to provide, or incorporate any Service into, any general purpose data warehousing service for the benefit of a third party; (c) reverse engineer, decompile, disassemble, or otherwise seek to obtain the source code or non-public APIs to any Service, except to the extent expressly permitted by applicable law (and then only upon advance written notice to Nockpoint); or (d) remove or obscure any proprietary or other notices contained in any Service.
#
# 1.6.  Acceptable Use Policy. Customer shall fully comply with Nockpoint's Acceptable Use Policy, attached.
#
# 2.   CUSTOMER DATA
#
# 2.1.  Rights in Customer Data. As between the parties, Customer or its licensors retain all right, title and interest (including any and all intellectual property rights) in and to the Customer Data and any modifications made thereto in the course of the operation of the Services as provided to Nockpoint. Subject to the terms of this Agreement, Customer hereby grants to Nockpoint and its Affiliates a non-exclusive, worldwide, royalty-free right to process the Customer Data solely to the extent necessary to provide the Services to Customer, to prevent or address service or technical problems with the Services, or as may be required by law.
#
# 2.2.  Use Obligations.
#
# (a)   In General. Customer's use of the Services and all Customer Data will comply with applicable laws and government regulations. Customer is solely responsible for the accuracy, content and legality of all Customer Data. Customer warrants that Customer has and will have sufficient rights in the Customer Data to grant the rights to Nockpoint under this Agreement and that the Customer Data will not violate the rights of any third party.
#
# (b)   HIPAA Data. Customer agrees not to upload to any Service any HIPAA Data unless Customer has entered into a BAA with Nockpoint. Unless a BAA is in place, Nockpoint will have no liability under this Agreement for HIPAA Data, notwithstanding anything to the contrary in this Agreement or in HIPAA or any similar federal or state laws, rules or regulations. If Customer is permitted to submit HIPAA Data to a Service, then Customer may submit HIPAA Data to Nockpoint and/or the Service only by uploading it as Customer Data. Upon mutual execution of the BAA, the BAA is incorporated by reference into this Agreement and is subject to its terms.
#
# 3.   INTELLECTUAL PROPERTY
#
# 3.1.  Nockpoint Technology. Customer agrees that Nockpoint or its suppliers retain all right, title and interest (including all patent, copyright, trademark, trade secret and other intellectual property rights) in and to the Services, all Documentation and Client Software, any Deliverables, and any and all related and underlying technology and documentation; and any derivative works, modifications, or improvements of any of the foregoing, including any Feedback that may be incorporated (collectively, "Nockpoint Technology"). Except for the express limited rights set forth in this Agreement, no right, title or interest in any Nockpoint Technology is granted to Customer. Further, Customer acknowledges that the Services are offered as an online, hosted solution, and that Customer has no right to obtain a copy of the underlying computer code for any Service, except (if applicable) for the Client Software in object code format. Notwithstanding anything to the contrary herein, Nockpoint may freely use and incorporate into Nockpoint's products and services any suggestions, enhancement requests, recommendations, corrections, or other feedback provided by Customer or by any users of the Services relating to Nockpoint's products or services ("Feedback").
#
# 3.2.  Usage Data. Notwithstanding anything to the contrary in this Agreement, Nockpoint may collect and use Usage Data to develop, improve, support, and operate its products and services. Nockpoint may not share any Usage Data that includes Customer's Confidential Information with a third party except (i) in accordance with Section 4 (Confidentiality) of this Agreement, or (ii) to the extent the Usage Data is aggregated and anonymized such that Customer and Customer's Users cannot be identified.
#
# 3.3.  Marketing. Nockpoint may use and display Customer's name, logo, trademarks, and service marks on Nockpoint's website and in Nockpoint's marketing materials in connection with identifying Customer as a customer of Nockpoint. Upon Customer's written request, Nockpoint will promptly remove any such marks from Nockpoint's website and, to the extent commercially feasible, Nockpoint's marketing materials. If Nockpoint requests, Customer agrees to participate in a case study, press release and/or cooperate with Nockpoint in speaking to the media, and to speak at a future Nockpoint event.
#
# 4.   CONFIDENTIALITY. Each party (as "Receiving Party") will use the same degree of care that it uses to protect the confidentiality of its own confidential information of like kind (but not less than reasonable care) to (i) not use any Confidential Information of the other party (the "Disclosing Party") for any purpose outside the scope of this Agreement, and (ii) except as otherwise authorized by the Disclosing Party in writing, limit access to Confidential Information of the Disclosing Party to those of its and its Affiliates' employees and contractors who need that access for purposes consistent with this Agreement and who have signed confidentiality agreements with the Receiving Party containing protections not materially less protective of the Confidential Information than those herein. If Receiving Party is required by law or court order to disclose Confidential Information, then Receiving Party shall, to the extent legally permitted, provide Disclosing Party with advance written notification and cooperate in any effort to obtain confidential treatment of the Confidential Information. The Receiving Party acknowledges that disclosure of Confidential Information would cause substantial harm for which damages alone would not be a sufficient remedy, and therefore that upon any such disclosure by the Receiving Party, the Disclosing Party will be entitled to seek appropriate equitable relief in addition to whatever other remedies it might have at law.
#
# 5.   FEES AND PAYMENT; TAXES; PAYMENT DISPUTES
#
# 5.1.  Fees and Payment. All Fees and payment terms are as set forth in the applicable Order Form. Except as expressly set forth in this Agreement, all payment obligations are non-cancelable and Fees are non-refundable. If Customer issues a purchase order upon entering into an Order Form, then: (i) any such purchase order submitted by Customer is for its internal purposes only, and Nockpoint rejects, and in the future is deemed to have rejected, any purchase order terms to the extent they add to or conflict in any way with this Agreement or the applicable Order Form and such additional or conflicting terms will have no effect, (ii) it shall be without limitation to Nockpoint's right to collect Fees owing hereunder, (iii) it shall be for the total Fees owing under the applicable Order Form, and (iv) on request, Nockpoint will reference the purchase order number on its invoices (solely for administrative convenience), so long as Customer provides the purchase order at least ten (10) business days prior to the invoice date.
#
# 5.2. Taxes. Fees do not include Taxes. Customer is responsible for paying all Taxes associated with its purchases hereunder including without limitation all use or access of the Services by its Users. If Nockpoint has the legal obligation to pay or collect Taxes for which Customer is responsible under this Section, Nockpoint will invoice Customer and Customer will pay that amount unless Customer provides Nockpoint with a valid tax exemption certificate authorized by the appropriate taxing authority. Taxes will not be deducted from payments to Nockpoint, except as required by applicable law, in which case Customer will increase the amount payable as necessary so that, after making all required deductions and withholdings, Nockpoint receives and retains (free from any liability for Taxes) an amount equal to the amount it would have received had no such deductions or withholdings been made. Upon Nockpoint's request, Customer will provide to Nockpoint its proof of withholding tax remittance to the respective tax authority. Where applicable, Customer will provide its VAT/GST Registration Number(s) on the Order Form to confirm the business use of the ordered Services.
#
# 5.3. Payment Disputes. Nockpoint will not exercise its rights under Section 6.2 (Termination for Cause) or Section 6.5(a) (Suspension of Service) with respect to non-payment by Customer if Customer is disputing the applicable charges reasonably and in good faith and is cooperating diligently to resolve the dispute. If the parties are unable to resolve such a dispute within thirty (30) days, each party shall have the right to seek any remedies it may have under this Agreement, at law or in equity, irrespective of any terms that would limit remedies on account of a dispute. For clarity, any undisputed amounts must be paid in full.
#
# 5.4.  Reseller Orders. If Customer has procured any Service or Technical Services through a Nockpoint-authorized distributor or reseller ("Reseller"), then different terms regarding invoicing, payment and taxes may apply as specified between Customer and its Reseller. Customer acknowledges that: (a) Nockpoint may share information with the Reseller related to Customer's use and consumption of the Services or Technical Services for account management and billing purposes; (b) the termination provisions below will also apply if Customer's Reseller fails to pay applicable fees; and (c) Reseller is not authorized to make any changes to this Agreement or otherwise authorized to make any warranties, representations, promises or commitments on behalf of Nockpoint or in any way concerning the Services or Technical Services.
#
# 6.   TERM AND TERMINATION
#
# 6.1.  Term. This Agreement is effective as of the Effective Date and will remain in effect until terminated in accordance with its terms. If there is no SOW, Order Form or Retrieval Right currently in effect, either party may terminate this Agreement upon written notice to the other party. Each Order Form will terminate upon expiration of the applicable Subscription Term, unless expressly stated otherwise therein or in this Agreement.
#
# 6.2.  Termination for Cause. Either party may terminate this Agreement (including all related Order Forms) if the other party (a) fails to cure any material breach of this Agreement (including a failure to pay Fees) within thirty (30) days after written notice; (b) ceases operation without a successor; or (c) seeks protection under any bankruptcy, receivership, trust deed, creditors' arrangement, composition, or comparable proceeding, or if any such proceeding is instituted against that party and is not dismissed within sixty (60) days. Except where an exclusive remedy is specified, the exercise of either party of any remedy under this Agreement, including termination, will be without prejudice to any other remedies it may have under this Agreement, by law or otherwise. For any termination of this Agreement by Customer for cause in accordance with Section 6.2(a), Customer shall be entitled to a refund of any unused Fees Customer has pre-paid for the Service purchased hereunder.
#
# 6.3.  Effect of Termination; Customer Data Retrieval. Upon written notice to Nockpoint or Reseller (if applicable), Customer will have up to thirty (30) calendar days from termination or expiration of this Agreement to access the Services solely to the extent necessary to retrieve Customer Data ("Retrieval Right"). If Customer exercises its Retrieval Right, this Agreement and the applicable Order Form shall continue in full force and effect for the duration of the Retrieval Right. Nockpoint shall have no further obligation to make Customer Data available after termination of this Agreement and shall thereafter promptly delete Customer Data. After the Retrieval Right period, Customer will have no further access to Customer Data and shall cease use of and access to the Services (including any related Nockpoint Technology) and delete all copies of Client Software, Documentation, any Service passwords or access codes, and any other Nockpoint Confidential Information in its possession.
#
# 6.4.  Survival. The following Sections will survive any expiration or termination of this Agreement: 1.5 (General Restrictions), 3 (Intellectual Property), 4 (Confidentiality), 5.1 (Fees and Payment), 5.2 (Taxes), 6 (Term and Termination), 7.3 (Warranty Disclaimer), 9 (Indemnification), 10 (Limitation of Remedies and Damages), 11 (General Terms), and 13 (Definitions).
#
# 6.5.  Suspension of Service. In addition to any of its other rights or remedies (including, without limitation, any termination rights) set forth in this Agreement, Nockpoint reserves the right to suspend provision of the Services: (a) if Customer (or Customer's Reseller, if applicable) is thirty (30) days or more overdue on a payment, (b) if Nockpoint deems such suspension necessary as a result of Customer's breach of Sections 1.5 (General Restrictions) or 2.2 (Use Obligations), (c) if Nockpoint reasonably determines suspension is necessary to avoid material harm to Nockpoint or its other customers, including if the Services are experiencing denial of service attacks, mail flooding, or other attacks or disruptions outside of Nockpoint's control, or (d) as required by law or at the request of governmental entities.
#
# 7.   WARRANTY
#
# 7.1.  Service Warranty. Nockpoint warrants that: (a) each Service will operate in substantial conformity with the applicable Documentation and (b) Technical Services and Deliverables will be provided in a professional and workmanlike manner and substantially in accordance with the specifications in the applicable SOW. If Nockpoint is not able to correct any reported nonconformity with this warranty, either party may terminate the applicable Order Form or SOW (as applicable), and Customer, as its sole remedy, will be entitled to receive a refund of any unused Fees that Customer has pre-paid for the applicable Service or Technical Services purchased thereunder. This warranty will not apply if the error or non-conformance was caused by misuse of the Service or Deliverables, modifications to the Service or Deliverables by Customer or any third-party, or third-party hardware, software, or services used in connection with the Service. For Technical Services and Deliverables, this warranty will not apply unless Customer provides written notice of a claim within thirty (30) days after expiration of the applicable SOW.
#
# 7.2.  Mutual Warranty. Each party warrants that it has validly entered into this Agreement and has the legal power to do so.
#
# 7.3. Warranty Disclaimer. EXCEPT AS EXPRESSLY SET FORTH IN THIS AGREEMENT, EACH SERVICE, THE CLIENT SOFTWARE, SAMPLE DATA, AND ALL TECHNICAL SERVICES AND SUPPORT ARE PROVIDED "AS IS" AND NOCKPOINT MAKES NO OTHER WARRANTIES, EXPRESS OR IMPLIED, STATUTORY OR OTHERWISE, INCLUDING BUT NOT LIMITED TO WARRANTIES OF MERCHANTABILITY, TITLE, FITNESS FOR A PARTICULAR PURPOSE, OR NON-INFRINGEMENT. NOCKPOINT DOES NOT WARRANT THAT THE USE OF ANY SERVICE WILL BE UNINTERRUPTED OR ERROR-FREE, NOR DOES NOCKPOINT WARRANT THAT IT WILL REVIEW THE CUSTOMER DATA FOR ACCURACY.
#
# 8.   TECHNICAL SERVICES
#
# 8.1.  Provision of Technical Services. Nockpoint will perform the Technical Services for Customer as set forth in each applicable SOW, subject to the terms and conditions of this Agreement. The Nockpoint personnel that Nockpoint assigns to perform the Technical Services will be professional and qualified in the performance of the applicable Technical Services. If Customer, in its reasonable judgement, believes that Nockpoint personnel assigned to a project do not meet the requirements in this Section, Nockpoint will in good faith discuss alternatives and will replace Nockpoint personnel as reasonably necessary. Where expressly stated in an SOW, Nockpoint will not remove personnel expressly named in the SOW without the prior written permission of Customer.
#
# 8.2.  Assistance. Customer acknowledges that timely access to applicable Customer Materials, resources, personnel, equipment or facilities is necessary for the provision of Technical Services. Customer agrees to provide such access and to reasonably cooperate with Nockpoint during a Technical Services project. Nockpoint will have no liability for any delay or deficiency to the extent resulting from Customer's breach of its obligations under this Section.
#
# 8.3.  Customer Materials. Customer hereby grants Nockpoint a limited right to use any materials provided to Nockpoint in connection with Technical Services projects (the "Customer Materials") solely for the purpose of providing Technical Services to Customer. Customer will retain any of its rights (including all intellectual property rights) in and to the Customer Materials. Nockpoint will treat Customer Materials subject to the confidentiality obligations under Section 4 (Confidentiality). Customer warrants that Customer has and will have sufficient rights in the Customer Materials to grant the rights to Nockpoint under this Agreement and that the Customer Materials will not violate the rights of any third party rights.
#
# 8.4.  License to Deliverables. The Technical Services Nockpoint performs (e.g., providing guidance on configuring the Nockpoint Services), and the resulting Deliverables are generally applicable to Nockpoint's business and are part of Nockpoint Technology. Subject to the terms and conditions of this Agreement (including the restriction in Section 1.5 (General Restrictions)), Nockpoint hereby grants Customer a limited, non-exclusive, royalty-free, non-transferable worldwide license to use the Deliverables internally solely in connection with such Customer's use of the applicable Service during the period in which such Customer has valid access to the Service. The parties may mutually agree to SOWs with additional terms and restrictions related to the use of Deliverables provided as part of that project, in which case those terms and restrictions will also apply for purposes of those Deliverables only.
#
# 8.5.  Change Orders; Other Terms. Customer may submit written requests to Nockpoint to change the scope of Technical Services under an existing SOW. Nockpoint will promptly notify Customer if it believes that the requested change requires an adjustment to the fees, schedule, assumptions or scope for the performance of the Technical Services. Neither party is bound by a change request unless agreed in writing by both parties pursuant to a mutually executed amendment or change order (each, a "Change Order"). Nockpoint will continue to perform Technical Services pursuant to the existing SOW unless the parties mutually agree to such Change Order. Nockpoint may use subcontractors to deliver Technical Services but will remain responsible for their performance of those Technical Services under the applicable terms and conditions of this Agreement. For clarity, Customer will be responsible for any consumption and other fees for the Service that are generated as part of the Technical Services.
#
# 9.   INDEMNIFICATION
#
# 9.1.  Indemnification by Nockpoint. Nockpoint will defend Customer against any claim by a third party alleging that any Service or Deliverable, when used in accordance with this Agreement, infringes any intellectual property right of such third party and will indemnify and hold harmless Customer from and against any damages and costs awarded against Customer or agreed in settlement by Nockpoint (including reasonable attorneys' fees) resulting from such claim. If Customer's use of any Service or Deliverable results (or in Nockpoint's opinion is likely to result) in an infringement claim, Nockpoint may either: (a) substitute functionally similar products or services; (b) procure for Customer the right to continue using the Service or Deliverable; or if (a) and (b) are not commercially reasonable, (c) terminate this Agreement, or the applicable Order Form or SOW and refund to Customer the unused Fees that Customer has pre-paid for the applicable Service or Deliverable. The foregoing indemnification obligation of Nockpoint will not apply to the extent the applicable claim is attributable to: (1) the modification of the Service or Deliverable by any party other than Nockpoint or based on Customer's specifications or requirements; (2) the combination of the Service or Deliverable with products or processes not provided by Nockpoint; (3) any use of the Service or Deliverables in non-conformity with this Agreement; or (4) any action arising as a result of Customer Data, or any deliverables or components not provided by Nockpoint. This Section sets forth Customer's sole remedy with respect to any claim of intellectual property infringement.
# 9.2.  Indemnification by Customer. Customer will defend Nockpoint against any claim by a third party arising from or relating to any Customer Data, Customer Materials or any Customer-offered product or service used in connection with the Services or any breach of this Agreement by Customer and will indemnify and hold harmless Nockpoint from and against any damages and costs awarded against Nockpoint or agreed in settlement by Customer (including reasonable attorneys' fees) resulting from such claim.
#
# 9.3.  Indemnification Procedures. In the event of a potential indemnity obligation under this Section, the indemnified party will: (i) promptly notify the indemnifying party in writing of the claim, (ii) allow the indemnifying party the right to control the investigation, defense and settlement (if applicable) of such claim at the indemnifying party's sole cost and expense, and (iii) upon request of the indemnifying party, provide all necessary cooperation at the indemnifying party's expense. Failure by the indemnified party to notify the indemnifying party of a claim under this Section shall not relieve the indemnifying party of its obligations under this Section, however the indemnifying party shall not be liable for any litigation expenses that the indemnified party incurred prior to the time when notice is given or for any damages and/or costs resulting from any material prejudice caused by the delay or failure to provide notice to the indemnifying party in accordance with this Section. The indemnifying party may not settle any claim that would bind the indemnified party to any obligation (other than payment covered by the indemnifying party or ceasing to use infringing materials) or require any admission of fault by the indemnified party, without the indemnified party's prior written consent, such consent not to be unreasonably withheld, conditioned or delayed. Any indemnification obligation under this Section will not apply if the indemnified party settles or makes any admission with respect to a claim without the indemnifying party's prior written consent.
#
# 10.   LIMITATION OF REMEDIES AND DAMAGES. TO THE MAXIMUM EXTENT PERMITTED BY LAW, AND NOTWITHSTANDING ANY OTHER PROVISION OF THIS AGREEMENT:
#
# (A)   NEITHER PARTY NOR ITS AFFILIATES SHALL BE LIABLE TO THE OTHER PARTY OR ITS AFFILIATES FOR ANY LOSS OF USE, LOST OR INACCURATE DATA, INTERRUPTION OF BUSINESS, COSTS OF DELAY, LOST PROFITS, OR ANY INDIRECT, SPECIAL, INCIDENTAL, RELIANCE, PUNITIVE, EXEMPLARY OR CONSEQUENTIAL DAMAGES OF ANY KIND, EVEN IF INFORMED OF THE POSSIBILITY OF SUCH DAMAGES IN ADVANCE;
#
# (B)   EXCEPT FOR CLAIMS FOR FEES, EACH PARTY'S AND ITS AFFILIATES' TOTAL LIABILITY TO THE OTHER PARTY AND ITS AFFILIATES FOR ALL CLAIMS IN THE AGGREGATE (FOR DAMAGES OR LIABILITY OF ANY TYPE), SHALL NOT EXCEED THE AMOUNT ACTUALLY PAID OR PAYABLE BY CUSTOMER TO NOCKPOINT IN THE PRIOR 12 MONTHS UNDER THE APPLICABLE ORDER FORM(S) OR SOW TO WHICH SUCH LIABILITY RELATES ("LIABILITY CAP");
#
# (C)   THE PARTIES AGREE THAT THIS SECTION WILL APPLY REGARDLESS OF THE FORM OF ACTION, WHETHER IN CONTRACT, TORT (INCLUDING NEGLIGENCE), STRICT LIABILITY OR OTHERWISE AND WILL APPLY EVEN IF ANY LIMITED REMEDY SPECIFIED IN THIS AGREEMENT IS FOUND TO HAVE FAILED OF ITS ESSENTIAL PURPOSE; AND
#
# (D)   THE LIABILITY CAP SET FORTH IN THIS SECTION SHALL APPLY ACROSS THIS AGREEMENT AND ANY AND ALL SEPARATE AGREEMENT(S) ON AN AGGREGATED BASIS, WITHOUT REGARD TO WHETHER ANY INDIVIDUAL CUSTOMER AFFILIATES HAVE EXECUTED A SEPARATE AGREEMENT IN ACCORDANCE WITH SECTION 1.2 (AFFILIATES).
#
# 11.   GENERAL TERMS
#
# 11.1. Assignment. This Agreement will bind and inure to the benefit of each party's permitted successors and assigns. Neither party may assign this Agreement without the advance written consent of the other party, except that either party may assign this Agreement in its entirety in connection with a merger, reorganization, acquisition, or other transfer of all or substantially all of such party's assets or voting securities to such party's successor; and Nockpoint may assign this Agreement in its entirety to any Affiliate. Each party shall promptly provide notice of any such assignment. Any attempt to transfer or assign this Agreement except as expressly authorized under this Section will be null and void.
#
# 11.2. Severability; Interpretation. If a court of competent jurisdiction holds any provision of this Agreement to be unenforceable or invalid, that provision will be limited to the minimum extent necessary so that this Agreement will otherwise remain in effect. Section headings are inserted for convenience only and shall not affect the construction of this Agreement.
#
# 11.3. Dispute Resolution. Each party agrees that before it seeks any form of legal relief (except for a provisional remedy as explicitly set forth below) it shall provide written notice to the other party of the specific issue(s) in dispute (and reference the relevant provisions of this Agreement which are allegedly being breached). Within thirty (30) days after such notice, knowledgeable executives of the parties shall hold at least one meeting (in person or by video- or tele-conference) for the purpose of attempting in good faith, to resolve the dispute. The parties agree to maintain the confidential nature of all disputes and disagreements between them, including, but not limited to, informal negotiations, mediation or arbitration, except as may be necessary to prepare for or conduct these dispute resolution procedures or unless otherwise required by law or judicial decision. The dispute resolution procedures in this Section shall not apply to claims subject to indemnification under Section 9 (Indemnification) or prior to a party seeking a provisional remedy related to claims of misappropriation or ownership of intellectual property, trade secrets or Confidential Information.
#
# 11.4. Governing Law; Jurisdiction and Venue; Nockpoint Affiliate. This Agreement will be governed by the laws of the State of Washington and the United States without regard to conflicts of laws provisions thereof, and without regard to the United Nations Convention on the International Sale of Goods; and the jurisdiction and venue for actions related to the subject matter hereof will be the state and federal courts located in King County, Washington, and both parties hereby submit to the personal jurisdiction of such courts. While the Nockpoint entity contracting with Customer or the Customer Affiliate remains fully liable and responsible for all Nockpoint obligations under this Agreement, the parties acknowledge that certain obligations under this Agreement may be fulfilled by other Nockpoint Affiliates.
#
# 11.5. Notice. Any notice or communication required or permitted under this Agreement will be in writing to the parties at the addresses set forth in this Agreement or at such other address as may be given in writing by either party to the other in accordance with this Section and will be deemed to have been received by the addressee: (i) if given by hand, immediately upon receipt; (ii) if given by overnight courier service, the first business day following dispatch; (iii) if given by registered or certified mail, postage prepaid and return receipt requested, the second business day after such notice is deposited in the mail; or (iv) if given by email, immediately upon receipt. Notwithstanding the foregoing, except for notices pertaining to non-payment and except as otherwise expressly permitted in this Agreement or in an Order Form, notices related to termination of this Agreement or any claims (including without limitation breach, warranty or indemnity) may not be given via email. Email notifications to Nockpoint shall be to legal@nockpoint.com.
#
# 11.6. Amendments; Waivers. No supplement, modification, or amendment of this Agreement will be binding, unless executed in writing by a duly authorized representative of each party to this Agreement, except as expressly set forth herein. No waiver will be implied from conduct or failure to enforce or exercise rights under this Agreement, nor will any waiver be effective unless in a writing signed by a duly authorized representative on behalf of the party claimed to have waived. No terms or conditions stated in a Customer purchase order, vendor onboarding process or web portal, or any other Customer order documentation (excluding Order Forms) shall be incorporated into or form any part of this Agreement, and all such terms or conditions shall be null and void, notwithstanding any language to the contrary therein, whether signed before or after this Agreement.
#
# 11.7. Entire Agreement. This Agreement is the complete and exclusive statement of the mutual understanding of the parties and supersedes and cancels all previous written and oral agreements and communications relating to the subject matter of this Agreement. Nockpoint may change and update any Service from time to time in its sole discretion (in which case Nockpoint may update the applicable Documentation accordingly).
#
# 11.8. Third Party Beneficiaries. There are no third-party beneficiaries under this Agreement.
#
# 11.9. Force Majeure. Neither party will be liable to the other for any delay or failure to perform any obligation under this Agreement (except for a failure to pay Fees) if the delay or failure results from any cause beyond such party's reasonable control, including but not limited to acts of God, labor disputes or other industrial disturbances, systemic electrical, telecommunications, or other utility failures, earthquake, storms or other elements of nature, blockages, embargoes, riots, public health emergencies (including pandemics and epidemics), acts or orders of government, acts of terrorism, or war.
#
# 11.10.        Independent Contractors. The parties to this Agreement are independent contractors. There is no relationship of partnership, joint venture, employment, franchise or agency created hereby between the parties. Neither party will have the power to bind the other or incur obligations on the other party's behalf without the other party's prior written consent and neither party's employees are eligible for any form or type of benefits, including, but not limited to, health, life or disability insurance, offered by the other party to its employees.
#
# 11.11.        Export Control. Customer agrees to comply with all export and import laws and regulations of the United States and other applicable jurisdictions. Without limiting the foregoing, (i) Customer represents and warrants that it is not listed on any U.S. government list of prohibited or restricted parties or located in (or a national of) a country that is subject to a U.S. government embargo or that has been designated by the U.S. government as a "terrorist supporting" country, (ii) Customer will not (and will not permit any third parties to) access or use any Service in violation of any U.S. export embargo, prohibition or restriction, and (iii) Customer will not submit to any Service any information that is controlled under the U.S. International Traffic in Arms Regulations.
#
# 11.12.        Counterparts. This Agreement may be executed in counterparts, each of which will be deemed an original and all of which together will be considered one and the same agreement.
#
# 11.13 Attorneys' Fees. If either party hereto brings any action to enforce such party's rights hereunder, the prevailing party in such action shall be entitled to recover reasonable attorneys' fees and costs incurred in connection with such action, whether in pretrial, trial, arbitration, appeal in any proceeding including bankruptcy, or in any action to enforce a judgment or award.
#
# 12.   RESELLER ORDERS. Customer may procure the Services directly from a Reseller pursuant to a separate agreement that includes the Reseller Order Form and other commercial terms (a "Reseller Arrangement"). Nockpoint will be under no obligation to provide the Services to Customer under a Reseller Arrangement if it has not received a Reseller Order Form for Customer. No Reseller is authorized to make any changes to this Agreement or otherwise authorized to make any warranties, representations, promises or commitments on behalf of Nockpoint or in any way concerning the Services. If Customer procures the Services through a Reseller Arrangement, then Customer agrees that Nockpoint may share certain Service Data with the Reseller related to Customer consumption of the Services.
#
# 13.   DEFINITIONS
#
# "Account" means Customer's account in the applicable Service in which Customer stores and processes Customer Data.
#
# "Affiliate" means an entity that, directly or indirectly, owns or controls, is owned or is controlled by, or is under common ownership or control with a party. As used herein, "control" means the power to direct the management or affairs of an entity and "ownership" means the beneficial ownership of more than fifty percent (50%) of the voting equity securities or other equivalent voting interests of an entity.
#
# "BAA" means a business associate agreement governing the parties' respective obligations with respect to any HIPAA Data uploaded by Customer to any Service in accordance with the terms of this Agreement.
#
# "Client Software" means the downloadable software programs offered by Nockpoint that are identified on an Order Form or otherwise downloaded or installed by Customer.
#
# "Confidential Information" shall mean all information that is identified as confidential at the time of disclosure by the Disclosing Party or should be reasonably known by the Receiving Party to be confidential or proprietary due to the nature of the information disclosed and the circumstances surrounding the disclosure. All Customer Data will be deemed Confidential Information of Customer without any marking or further designation. All Nockpoint Technology and the terms and conditions of this Agreement will be deemed Confidential Information of Nockpoint without any marking or further designation. Confidential Information shall not include information that the Receiving Party can demonstrate: (i) was rightfully in its possession or known to it prior to receipt of the Confidential Information; (ii) is or has become public knowledge through no fault of the Receiving Party; (iii) is rightfully obtained by the Receiving Party from a third party without breach of any confidentiality obligation; or (iv) is independently developed by employees of the Receiving Party who had no access to such information.
#
# "Contractor" means the independent contractors and consultants permitted by Customer to serve as Users of any Service.
#
# "Customer Data" means any data or data files of any type that are uploaded by or on behalf of Customer to any Service for storage in a data repository.
#
# "Deliverables" means the guides, code (including SQL queries) or other deliverables that Nockpoint provides to Customer in connection with Technical Services. For clarity, Nockpoint may use compilers, assemblers, interpreters and similar tools to develop Deliverables. The term "Deliverables" does not include such tools.
#
# "Disclosing Party" is defined in Section 4 (Confidentiality).
#
# "Documentation" means Nockpoint's technical documentation and usage guides for the applicable Service made available through the Service or otherwise delivered by Nockpoint to Customer.
#
# "Feedback" is defined in Section 3.1 (Nockpoint Technology).
#
# "Fees" means the fees payable by Customer for the applicable Service or Technical Services, as set forth in an Order Form or SOW. For Technical Services, the term Fees also includes travel, lodging, meal and other expenses incurred in the course of providing Technical Services.
#
# "HIPAA" means the Health Insurance Portability and Accountability Act, as amended and supplemented.
#
# "HIPAA Data" means any patient, medical or other protected health information regulated by HIPAA or any similar federal or state laws, rules or regulations.
#
# "Nockpoint" means Nockpoint, Inc. or its Affiliate which executes an Order Form that is governed by this Agreement.
#
# "Nockpoint Technology" is defined in Section 3.1 (Nockpoint Technology).
#
# "Order Form" means the Nockpoint ordering document (and/or an SOW, if applicable) executed by both Customer and Nockpoint which specifies the Services and/or Technical Services being provided by Nockpoint and that is governed by this Agreement.
#
# "Receiving Party" is defined in Section 4 (Confidentiality).
#
# "Retrieval Right" is defined in Section 6.3 (Effect of Termination; Customer Data Retrieval).
#
# "Sample Data" means any data (including from third-party sources) provided or made available to Customer by Nockpoint solely for Customer's internal testing, evaluation, and other non-productive use of the Services during the Subscription Term.
#
# "Service" means a Nockpoint software-as-a-service offering made generally available and ordered by Customer as set forth in an Order Form.
#
# "SOW" means a statement of work executed by both Customer and Nockpoint which specifies the Technical Services being provided by Nockpoint and that is governed by this Agreement.
#
# "Subscription Term" means the set term designated on an Order Form.
#
# "Taxes" means taxes, levies, duties or similar governmental assessments of any nature, including, for example, any sales, use, GST, value-added, withholding, or similar taxes, whether domestic or foreign, or assessed by any jurisdiction, but excluding any taxes based on net income, property, or employees of Nockpoint.
#
# "Technical Services" shall mean the consulting, configuration or other professional services provided by Nockpoint to Customer under an Order Form or SOW.
#
# "Third Party Applications" means separate services or applications (and other consulting services related thereto) provided to Customer by a party other than Nockpoint for use in connection with the Services.
#
# "Usage Data" means query logs, and any data (other than Customer Data) relating to the operation, support and/or about Customer's use of the Services.
#
# "User" means the persons designated and granted access to the Services by or on behalf of Customer.  Users may include, without limitation, authorized clients of Customer, and Customer's and its Affiliates' Contractors, if applicable.
#
# "VAT/GST Registration Number" means the value added tax/GST registration number of the business location(s) where Customer is legally registered and the ordered Services are used for business use.
#
#
# Nockpoint Acceptable Use Policy
#
# This Nockpoint acceptable use policy ("AUP") sets forth certain restrictions on accessing and using Nockpoint Inc.'s and its affiliates (collectively, "Nockpoint", "We", "Our" or "Us") products and services, including Nockpoint's software-as-a-service offering, Customer Software, and any equipment (including servers or networks) used in connection therewith (collectively, "Offerings") by you or someone on your behalf ("You" or "Your") under your agreement with Nockpoint for such Offerings ("Agreement"). The restrictions set forth in this AUP are not exhaustive. You may not use the Offerings:
# 1.    to store, transmit, or make available (a) content that is infringing, libelous, unlawful, tortious, or in violation of third-party rights, (b) content or technology that harms, interferes with, or limits the normal operation of the Offerings, including monitoring traffic or data, or (c) viruses, malware, or other malicious code;
# 2.    for illegal, threatening, or offensive uses, or for similarly objectionable purposes, such as propagating hate or violence or causing harm to others or to Our reputation;
# 3.    to transact in, or facilitate activities related to, misappropriating another individual's identity, including, but not limited to, improperly obtained credit card information and/or account credentials;
# 4.    to attempt to gain unauthorized access to any Offerings or any related systems, including those of Nockpoint's subcontractors and other customers or users;
# 5.    to permit direct or indirect access to or use of any Offerings in a way that violates the Agreement or use any Offerings to access or use any intellectual property in or related to the Offerings except as permitted under the Agreement;
# 6.    to copy the Offerings, or any part, feature, function or user interface thereof except as expressly allowed for Client Software under the Agreement; or
# 7.    in order to benchmark Offerings or to build similar or competitive products or services.
#
# Any capitalized terms used but not defined herein shall have the meaning set forth in the Agreement or the Documentation, as applicable. Notwithstanding anything to the contrary in the Agreement, in the event of any conflict between the Agreement and this AUP, this AUP shall govern. This AUP may be updated by Nockpoint from time to time upon reasonable notice (which may be provided through the Service or by posting an updated version of this AUP). Any violation of this AUP may result in the suspension or termination of your access to and use of the Offerings.
#
# Last Updated: 2021 May 31
#
#
## Login Credentials of Snowflake Instance
import snowflake.connector
ctx = snowflake.connector.connect(
    user='Snowflake user name',
    password='Snowflake password. Recommend using key based authentication',
    account='bo44078',
    database='VENDORS',
    schema='Reference'
    )

cs = ctx.cursor()
try:
        # Variable Initialization
        sql = """SET (JIRA_ISSUES_IN,JIRA_USERS_IN,ZENDESK_MS_TICKETS_IN,ZENDESK_MS_TICKETS_METRICS_IN,ZENDESK_MS_TICKETS_COMMENTS_IN,ZENDESK_MS_USERS_IN,ZENDESK_MS_ORG_IN,SUPPORT_ORG_OUT,SUPPORT_USERS_OUT,SUPPORT_REQUESTORS_OUT,SUPPORT_TICKETS_OUT,DEFECTS_MS_OUT,STATUS_OUT,REFERENCE_SUPPORT_IN,REFERENCE_IN,PRIORITY_IN) =
                                                                                                        ('VENDORS.JIRA__WOBOCO.ISSUES'
                                                                                                        ,'VENDORS.JIRA__WOBOCO.USERS'
                                                                                                        ,'VENDORS.ZENDESK_MICROSOFT.TICKETS'
                                                                                                        ,'VENDORS.ZENDESK_MICROSOFT.TICKET_METRICS'
                                                                                                        ,'VENDORS.ZENDESK_MICROSOFT.TICKET_COMMENTS'
                                                                                                        ,'VENDORS.ZENDESK_MICROSOFT.USERS'
                                                                                                        ,'VENDORS.ZENDESK_MICROSOFT.ORGANIZATIONS'
                                                                                                        ,'"VENDORS"."NOCKPOINT"."SUPPORT_ORGANIZATION"'
                                                                                                        ,'"VENDORS"."NOCKPOINT"."SUPPORT_USERS"'
                                                                                                        ,'"VENDORS"."NOCKPOINT"."SUPPORT_REQUESTORS"'
                                                                                                        ,'"VENDORS"."NOCKPOINT"."SUPPORT_TICKETS"'
                                                                                                        ,'"VENDORS"."NOCKPOINT"."DEFECTS_Microsoft"'
                                                                                                        ,'"VENDORS"."NOCKPOINT"."Status"'
                                                                                                        ,'"VENDORS"."NOCKPOINT"."TICKETS_CONFIG_STATUS"'
                                                                                                        ,'"VENDORS"."NOCKPOINT"."DEFECTS_CONFIG_STATUS"'
                                                                                                        ,'"VENDORS"."NOCKPOINT"."DEFECTS_CONFIG_PRIORITY"');"""
        cs.execute(sql)
        # To Create Table "SUPPORT_ORGANIZATION"
        sql = """CREATE OR REPLACE TABLE IDENTIFIER($SUPPORT_ORG_OUT) as
                 select id "ID"
                 ,_SDC_BATCHED_AT "_SDC_BATCHED_SO"
                 ,name "Name"
                 from TABLE ($ZENDESK_MS_ORG_IN);"""
        cs.execute(sql)
        # To Create Table "SUPPORT_USERS"
        sql = """CREATE OR REPLACE TABLE IDENTIFIER($SUPPORT_USERS_OUT) as
                 select  a.id "User_ID"
                 ,a._SDC_BATCHED_AT "_SDC_BATCHED_SU"
                 ,a.name "User_Name"
                 ,a.email "User_Email"
                 ,a.role "User_Role"
                 ,a.ORGANIZATION_ID "User_Company_ID"
                 ,b.name "User_Company"
                 from TABLE ($ZENDESK_MS_USERS_IN) a
                 left join
                 TABLE ($ZENDESK_MS_ORG_IN) b
                 on a.ORGANIZATION_ID = b.id;"""
        cs.execute(sql)
        # To Create Table "SUPPORT_REQUESTORS"
        sql = """CREATE OR REPLACE TABLE  IDENTIFIER($SUPPORT_REQUESTORS_OUT) AS
                 select  DISTINCT(a.requester_id) "Requestor_ID"
                 ,b.user_name "Requestor_Name"
                 ,a._SDC_BATCHED_AT "_SDC_BATCHED_SR"
                 ,c.name "Requestor_Company"
                 from TABLE ($ZENDESK_MS_TICKETS_IN) a
                 join
                 (select id
                 ,name user_name
                 ,organization_id
                 from TABLE ($ZENDESK_MS_USERS_IN)) b
                 on a.requester_id = b.id
                 left join
                 (select id
                 ,name
                 from TABLE ($ZENDESK_MS_ORG_IN)) c
                 on b.organization_id = c.id;"""
        cs.execute(sql)
        # To Create Table "SUPPORT_TICKETS"
        sql = """CREATE OR REPLACE TABLE IDENTIFIER($SUPPORT_TICKETS_OUT) as
                 select concat ('WKBD-ZDMS-',a.id) "NPID",a.id "ID"
                 ,a.created_at "Created_date"
                 ,a.description "Description"
                 ,a.priority "Priority"
                 ,a.raw_subject "Subject"
                 ,a.status "Status"
                 ,trim(a.tags::string,'[]') "Tags"
                 ,dayname(a.created_at) "Day of Week"
                 ,a._SDC_BATCHED_AT "_SDC_BATCHED_SUP"
                 ,b.solved_at "Closed_date"
                 ,b.REPLIES "Replies"
                 ,b.REOPENS "Reopens"
                 ,b.First_Resolution_Business "First_Resolution_Business"
                 ,b.First_Resolution_Calendar "First_Resolution_Calendar"
                 ,b.Full_Resolution_Business "Full_Resolution_Business"
                 ,b.Full_Resolution_Calendar "Full_Resolution_Calendar"
                 ,b.REPLY_TIME_Business "REPLY_TIME_Business"
                 ,b.REPLY_TIME_Calendar "REPLY_TIME_Calendar"
                 ,b.ON_HOLD_TIME_Business "ON_HOLD_TIME_Business"
                 ,b.ON_HOLD_TIME_Calendar "ON_HOLD_TIME_Calendar"
                 ,c.name "Source"
                 ,d.number_of_comments "Number_of_Comments"
                 ,e.name "Assignee_Name"
                 ,e.email "Assignee_Email"
                 ,f.assignee_organization "Assignee_Company"
                 ,g.name "Requestor_Name"
                 ,g.email "Requestor_Email"
                 ,h.requester_organization "Requestor_Company"
                 ,i.category "Category"
                 ,round("Full_Resolution_Business"/11,1) "S_Days_To_Close_Bus"
                 ,round("Full_Resolution_Calendar"/24,1) "S_Days_To_Close_Cal"
                 ,iff("Full_Resolution_Calendar" <= 24 and ("Status" = 'closed' or "Status" ='solved'),1,0) "S_24_Hour_Tickets_Flag"
                 ,concat ('https://msworkboard.zendesk.com/agent/tickets/',a.id) "Ticket URL"
                 ,case
                            when Tags like all ('%bug_filed%','%feature_request%') then 'Bug & Feature Request'
                            when Tags like '%bug_filed%' then 'Bug'
                            when Tags like '%feature_request%' then 'Feature Request'
                            else 'Other'
                            end as "Hold_Group"
                  ,r.Color_group as "Status_Cnd_fmt"
                  ,r.Color_grp as "Status_Color"
                  from TABLE ($ZENDESK_MS_TICKETS_IN) as a
                  left join TABLE ($REFERENCE_SUPPORT_IN) r
                  on a.status = r.Status
                  join
                  (select ticket_id
                   ,solved_at
                   ,REPLIES,REOPENS
                   ,(FIRST_RESOLUTION_TIME_IN_MINUTES:business::number)/60 First_Resolution_Business
                   ,(FIRST_RESOLUTION_TIME_IN_MINUTES:calendar::number)/60 First_Resolution_Calendar
                   ,(FULL_RESOLUTION_TIME_IN_MINUTES:business::number)/60 Full_Resolution_Business
                   ,(FULL_RESOLUTION_TIME_IN_MINUTES:calendar::number)/60 Full_Resolution_Calendar
                   ,(REPLY_TIME_IN_MINUTES:business::number)/60 REPLY_TIME_Business
                   ,(REPLY_TIME_IN_MINUTES:calendar::number)/60 REPLY_TIME_Calendar
                   ,(ON_HOLD_TIME_IN_MINUTES:business::number)/60 ON_HOLD_TIME_Business
                   ,(ON_HOLD_TIME_IN_MINUTES:calendar::number)/60 ON_HOLD_TIME_Calendar
                   from TABLE ($ZENDESK_MS_TICKETS_METRICS_IN)) b
                   on a.id = b.ticket_id
                   left join
                   (select name
                   ,id
                   from TABLE ($ZENDESK_MS_ORG_IN)) c
                   on a.organization_id = c.id
                   left join
                   (select ticket_id
                   ,count(id) number_of_comments
                   from TABLE ($ZENDESK_MS_TICKETS_COMMENTS_IN)
                   group by ticket_id)d
                   on a.id = d.ticket_id
                   left join
                   (select organization_id
                   ,id
                   ,name
                   ,email
                   from TABLE ($ZENDESK_MS_USERS_IN))e
                   on a.assignee_id = e.id
                   left join
                   (select name assignee_organization
                    ,id
                   from TABLE ($ZENDESK_MS_ORG_IN)) f
                   on e.organization_id = f.id
                   left join
                   (select organization_id,id,name,email from TABLE ($ZENDESK_MS_USERS_IN))g
                   on a.requester_id = g.id
                   left join
                   (select name requester_organization
                   ,id
                   from TABLE ($ZENDESK_MS_ORG_IN)) h on g.organization_id = h.id
                   join
                   (select id
                    ,value:value::string category
                    from TABLE ($ZENDESK_MS_TICKETS_IN)
                    ,lateral flatten( input =>  custom_fields)) i
                    on i.id = a.id
                    where a.status != 'deleted';"""
        cs.execute(sql)
        cs.execute("""ALTER TABLE IDENTIFIER($SUPPORT_TICKETS_OUT) ADD PRIMARY KEY("NPID");""")
        # To Create Table "DEFECTS_Microsoft"
        sql = """CREATE OR REPLACE TABLE IDENTIFIER($DEFECTS_MS_OUT) as
                    select concat ('WKBD-JIMS-',ID) "NPID"
                    ,id
                    ,key "Key"
                    ,fields:created::timestamp_tz "Created_at"
                    ,date(fields:created::timestamp_tz) "Created_at_date"
                    ,dayname(fields:created::timestamp) "Day of Week"
                    ,fields:issuetype.name::string "Issuetype"
                    ,fields:customfield_10106::string "Prioritypoints"
                    ,fields:updated::string "Updated"
                    ,iff(fields:status.name::string = 'Deployed',iff(fields:resolutiondate::string != null,to_timestamp_tz(regexp_replace(fields:resolutiondate::string,'T',' ')),to_timestamp_tz(regexp_replace(fields:statuscategorychangedate::string,'T',' '))),null)"Resolution_date"
                    ,round(datediff(hour,"Created_at",current_date())/24,1) "Age"
                    ,fields:customfield_10090::string "Zendesk_Ticket_ID's"
                    ,fields:customfield_10091::number "Zendesk_Ticket_Count"
                    ,to_number(timediff(minute,"Created_at","Resolution_date")/60,10,1) Hours_to_complete
                    ,round(Hours_to_complete/24,1)Days_to_complete
                    ,concat(year("Created_at"),'-',month("Created_at"))Created_month
                    ,concat(year("Resolution_date"),'-',month("Resolution_date"))Closed_month
                    ,_SDC_BATCHED_AT "_SDC_BATCHED_DEF_MS"
                    ,iff(r.Status_Group is not null,r.Status_Group,'Other') "STATUS_GROUP"
                    ,iff(r.Color_group is not null,r.Color_group,'#F6BABB')"COLOR_GROUP"
                    ,iff(r.Color_grp is not null,r.Color_grp,'4') "COLORGRP"
                    ,iff(p.Priority is not null,p.Priority,'Other') "PRIORITY_POINT_STATUS"
                    ,iff(p.Priority_sort is not null,p.Priority_sort,'4') "PRIORITY_SORT"
                    ,iff(Status_Group='Deployed',Days_to_complete,null) "Median_Days_Complete_MS"
              from TABLE ($JIRA_ISSUES_IN) i
              LEFT JOIN  TABLE ($REFERENCE_IN) r on
              i.fields:status.name::string = r.Status
              LEFT JOIN TABLE ($PRIORITY_IN) p on
              i.fields:customfield_10106::string >= p.Lower_limit AND i.fields:customfield_10106::string <= p.Upper_limit
              where fields:customfield_10086::string like '%MicrosoftC+AI%'
              AND
              fields:status.name::string != 'ARCHIVED'
              AND
              fields:status.name::string != 'DUPLICATE';"""
        cs.execute(sql)
        cs.execute("""ALTER TABLE IDENTIFIER($DEFECTS_MS_OUT) ADD PRIMARY KEY ("NPID");""")
        sql = """CREATE TABLE IF NOT EXISTS IDENTIFIER($STATUS_OUT) (
                 Status varchar(255)
                 ,Instance varchar(255)
                 ,Number_of_rows int
                 ,Last_refresh_date timestamp
                 );"""
        cs.execute(sql)
        r=0
except:
    r=1
    cs.execute( """insert into IDENTIFIER($STATUS_OUT) values ('Failed','MS',0,current_timestamp())""")
finally:
    if r==0:
        cs.execute("""select count(*) from IDENTIFIER($DEFECTS_MS_OUT);""")
        a=cs.fetchone()[0]
        cs.execute("""select count(*) from IDENTIFIER($SUPPORT_TICKETS_OUT);""")
        b=cs.fetchone()[0]
        cs.execute("""insert into IDENTIFIER($STATUS_OUT) values ('Success','DEFECTS_MS',{0},current_timestamp())""".format(a))
        cs.execute("""insert into IDENTIFIER($STATUS_OUT) values ('Success','SUPPORT_MS',{0},current_timestamp())""".format(b))
ctx.close()
